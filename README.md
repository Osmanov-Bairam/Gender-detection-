
# **Предсказание пола клиента**

## **Введение**

Необходимо было выявить пол клиента, основываясь на его транзакционных исторических данных. В роли метрики качества выступает [ROC AUC].

## **Задачи**

•	Разработать модель бинарной классификации для определения пола клиента. Главное, чтобы ROC AUC на отложенном тесте получился выше 77.5%.
•	Интерпретировать результаты модели: важность входящих в нее переменных, демонстрация на нескольких примерах, почему получился соответствующий прогноз.
•	Конвертировать результаты в отчет без кода.

## **Подготовка**

### **Данные были разделены на 5 групп.**

1.	**Репрезентативная выборка**, состоящая из 100 000 записей. Она была создана для быстрой оценки данных. Основываясь на этой выборке, я произвел:
  a.	Анализ данных.
  b.	Сравнение различных алгоритмов по скорости обучения и ROC AUC.
2.	**Полная выборка**, состоящая из 3 700 000 записей. Основываясь на этой выборке, я произвел:
  a.	Финальное обучение модели.
  b.	Оценку важности признаков клиентов.
  c.	Подбор гиперпарметров (оставил на потом из-за нехватки ресурсов)
3.	**Тестовая выборка**, состоящая из 3 100 000 записей. Основываясь на этой выборке, я произвел:
  a.	Финальное предсказание, которое будет использоваться для оценки моей работы HR.
4.	**Тренировочная и валидационная выборка**, состоящая из 1 850 000 записей каждая. Основываясь на этих выборках, я произвел:
  a.	Проверку точности предсказаний на данных, которую модель не видела. Данная оценка нужна была уверенности в хороших предсказаниях модели до проверки на тестовой выборке.

### **Данные были предварительно обработаны**

1.	Найдены отсутствующие данные для признака - term_id (идентификатор терминала). Использовались 2 метода:
  a.	Случайный выбор категории с учетом его распределения в тренировочных данных. Подробности в блокноте.
  b.	Добавления индикатора к каждому наблюдению, где отсутствовал признак.
2.	Было создано **15** новых признаков.
3.	Редкие категории объединены в общую группу Rare.
   
    **MCC-код транзакции** (До / После)
    ![image](https://user-images.githubusercontent.com/73111855/153935756-329842e4-a4a7-41e0-8ed8-904067efb71a.png)
    ![image](https://user-images.githubusercontent.com/73111855/153936424-e7054be9-61da-4193-9afd-3afae3718220.png)

    
    **Тип транзакции**(До / После)
    ![image](https://user-images.githubusercontent.com/73111855/153935903-a983e7ad-ccf1-47d0-98cb-0cfd0ad55db8.png)
    ![image](https://user-images.githubusercontent.com/73111855/153936486-51e82135-5a9b-4349-a10e-0e295fffc08c.png)

    
    **Время проведения транзакции** (До / После)
    ![image](https://user-images.githubusercontent.com/73111855/153935989-691c32e3-2ad1-42ff-b44f-940dc59b8fee.png)
    ![image](https://user-images.githubusercontent.com/73111855/153936642-c53c2555-a1e4-4d67-9c06-84bf1ffa7a59.png)


4.	Категориальные признаки были закодированы. Каждый признак был заменен на число, характеризующий частоту появления даного признака в тренировочных данных.
5.	Произведена проверка наличие утечки данных на этапе обработки.

## **Выбор модели**

В качестве финальной модели был выбран алгоритм Random Forest, у которого оптимальное время обучение и точность предсказаий. 

![image](https://user-images.githubusercontent.com/73111855/153937221-f1c4d809-bdd5-4ca2-a787-a81e0951d4eb.png)

![image](https://user-images.githubusercontent.com/73111855/153937337-865ae87b-bdde-435c-8739-b2214930d820.png)

## **Топ 13 признаков** 

Все признаки были отфильтрованы. Для фильтрации был создан признак Random_variable со случайными числами на этапе генерации новых признаков.

![Важность](https://user-images.githubusercontent.com/73111855/153937056-2b462adf-b495-4682-8c7c-3a57d347cad1.png)

 'Mean_net_money_per_day'  = средняя сумма транзакции за все время одним клиентом.
 
 'Std_net_money_per_day' = среднее отклонение 'Mean_net_money_per_day' одним клиентом.
 
 'Mean_spend_money_per_day' = средняя отрицательная транзакция за все время одним клиентом.
 
 'Mean_earn_money_per_day' = средняя положительная транзакция за все время одним клиентом.
 
 'Money_spend_std_per_day' = среднее отклонение 'Mean_spend_money_per_day' одним клиентом.
 
 'Mean_earn_std_per_day' = среднее отклонение 'Mean_earn_money_per_day' одним клиентом.
 
 'Money_earn_spend_ratio_per_day' = отношение средней положительной и отрицательной транзакции за все время одним клиентом.
 
 'ALL_money_net' = общая сумма транзакций за все время одним клиентом.
 
 'ALL_money_spend' = общая сумма отрицательных транзакций за все время одним клиентом.
 
 'ALL_money_earn' = общая сумма положительных транзакций за все время одним клиентом.
 
 'ALL_money_spend_earn_ratio' = отношение общих отрицательных и положительных сумм транзакций.
 
 'Frequency_of_spending_all' = частота свершения транзакций за день.
 
 'Frequency_of_spending_per_week' = частота свершения транзакций за неделю.
 
 
## **Интерпретация признаков**

1 - женщины (предположение)
0 - мужчины (предположение)

1. 'Frequency_of_spending_all'. Мужчины более склонны часто совершать транзакции течении дня.
2. 'ALL_money_spend'. Женщины меньше тратят, чем мужчины.

![image](https://user-images.githubusercontent.com/73111855/154002331-d3796d30-f4e1-4d15-9973-a6c31d8eba9c.png)


## **Результаты**

Финальный ROC AUC на валидации по 4FOLD в среднем – **0.9429**.

Финальные ответ для тестовой выборки сохранен в таблице X_test_encod в колонке gender в разделе блокнота FOR ASSESMENT.

## **Будущие улучшения**

1.	Подобрать гиперпараметры для лучшей генерализации предсказаний.

2.	Использовать нейронные сети для генерации признаков.
